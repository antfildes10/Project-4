{% extends 'base/base.html' %}

{% block title %}
  Edit Profile - KartControl

{% endblock %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h1 class="h3 mb-0">
            <i class="fas fa-edit"></i> Edit Profile
          </h1>
        </div>
        <div class="card-body">
          <form method="post" novalidate>
            {% csrf_token %}

            <fieldset class="mb-4">
              <legend class="h5">
                Account Information
              </legend>

              <!-- Username Field -->
              <div class="mb-3">
                <label for="{{ user_form.username.id_for_label }}" class="form-label">
                  Username <span class="text-danger" aria-hidden="true">*</span>
                </label>
                <input type="text"
                       name="username"
                       id="{{ user_form.username.id_for_label }}"
                       value="{% if user_form.username.value %}{{ user_form.username.value }}{% else %}{{ user.username }}{% endif %}"
                       class="form-control
                              {% if user_form.username.errors %}
                                is-invalid
                              {% endif %}"
                       required
                       autocomplete="username"
                       maxlength="150" />
                <div class="form-text">
                  150 characters or fewer. Letters, digits and @/./+/-/_ only.
                </div>
                {% if user_form.username.errors %}
                  <div class="invalid-feedback" role="alert">
                    {{ user_form.username.errors|join:", " }}
                  </div>
                {% endif %}
              </div>

              <!-- Email Field -->
              <div class="mb-3">
                <label for="{{ user_form.email.id_for_label }}" class="form-label">
                  Email Address <span class="text-danger" aria-hidden="true">*</span>
                </label>
                <input type="email"
                       name="email"
                       id="{{ user_form.email.id_for_label }}"
                       value="{% if user_form.email.value %}{{ user_form.email.value }}{% else %}{{ user.email }}{% endif %}"
                       class="form-control
                              {% if user_form.email.errors %}
                                is-invalid
                              {% endif %}"
                       required
                       autocomplete="email" />
                {% if user_form.email.errors %}
                  <div class="invalid-feedback" role="alert">
                    {{ user_form.email.errors|join:", " }}
                  </div>
                {% endif %}
              </div>

              <!-- First Name Field -->
              <div class="mb-3">
                <label for="{{ user_form.first_name.id_for_label }}" class="form-label">
                  First Name <span class="text-danger" aria-hidden="true">*</span>
                </label>
                <input type="text"
                       name="first_name"
                       id="{{ user_form.first_name.id_for_label }}"
                       value="{% if user_form.first_name.value %}{{ user_form.first_name.value }}{% else %}{{ user.first_name }}{% endif %}"
                       class="form-control
                              {% if user_form.first_name.errors %}
                                is-invalid
                              {% endif %}"
                       required
                       autocomplete="given-name"
                       maxlength="150" />
                {% if user_form.first_name.errors %}
                  <div class="invalid-feedback" role="alert">
                    {{ user_form.first_name.errors|join:", " }}
                  </div>
                {% endif %}
              </div>

              <!-- Last Name Field -->
              <div class="mb-3">
                <label for="{{ user_form.last_name.id_for_label }}" class="form-label">
                  Last Name <span class="text-danger" aria-hidden="true">*</span>
                </label>
                <input type="text"
                       name="last_name"
                       id="{{ user_form.last_name.id_for_label }}"
                       value="{% if user_form.last_name.value %}{{ user_form.last_name.value }}{% else %}{{ user.last_name }}{% endif %}"
                       class="form-control
                              {% if user_form.last_name.errors %}
                                is-invalid
                              {% endif %}"
                       required
                       autocomplete="family-name"
                       maxlength="150" />
                {% if user_form.last_name.errors %}
                  <div class="invalid-feedback" role="alert">
                    {{ user_form.last_name.errors|join:", " }}
                  </div>
                {% endif %}
              </div>
            </fieldset>

            <fieldset>
              <legend class="h5">
                Personal Information
              </legend>

              <!-- Phone Number Field -->
              <div class="mb-3">
                <label for="{{ profile_form.phone_number.id_for_label }}" class="form-label">
                  Phone Number
                </label>
                <input type="tel"
                       name="phone_number"
                       id="{{ profile_form.phone_number.id_for_label }}"
                       value="{% if profile_form.phone_number.value %}{{ profile_form.phone_number.value }}{% elif user.profile.phone_number %}{{ user.profile.phone_number }}{% endif %}"
                       class="form-control
                              {% if profile_form.phone_number.errors %}
                                is-invalid
                              {% endif %}"
                       autocomplete="tel"
                       maxlength="20" />
                <div class="form-text">
                  Optional. Format: +353 1 234 5678
                </div>
                {% if profile_form.phone_number.errors %}
                  <div class="invalid-feedback" role="alert">
                    {{ profile_form.phone_number.errors|join:", " }}
                  </div>
                {% endif %}
              </div>

              <!-- Date of Birth Field -->
              <div class="mb-3">
                <label for="id_date_of_birth" class="form-label">
                  Date of Birth
                </label>
                <input type="date"
                       name="date_of_birth"
                       id="id_date_of_birth"
                       value="{{ profile_form.date_of_birth.value|date:'Y-m-d'|default:'' }}"
                       class="form-control
                              {% if profile_form.date_of_birth.errors %}
                                is-invalid
                              {% endif %}" />
                <div class="form-text">
                  Optional. Required for competitive racing events.
                </div>
                {% if profile_form.date_of_birth.errors %}
                  <div class="invalid-feedback" role="alert">
                    {{ profile_form.date_of_birth.errors|join:", " }}
                  </div>
                {% endif %}
              </div>
            </fieldset>

            <!-- Non-field errors -->
            {% if user_form.non_field_errors or profile_form.non_field_errors %}
              <div class="alert alert-danger" role="alert">
                {{ user_form.non_field_errors|join:", " }}
                {{ profile_form.non_field_errors|join:", " }}
              </div>
            {% endif %}

            <!-- Action Buttons -->
            <div class="d-flex gap-2 mt-4">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Save Changes
              </button>
              <a href="{% url 'accounts:profile' %}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Cancel
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

{% endblock %}
